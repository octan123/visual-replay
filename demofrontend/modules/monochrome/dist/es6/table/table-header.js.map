{"version":3,"sources":["../../../src/table/table-header.js"],"names":["React","PureComponent","PropTypes","AutoSizer","memoize","HeaderContainer","HeaderCell","SortIcon","SORT","NONE","ASCEND","DESCEND","TableHeader","constructor","props","columns","formatColumns","map","col","colIndex","ref","_cells","width","clientWidth","onResize","index","sortType","sort","forEach","multiplier","sortFunc","row1","row2","data","onSort","forceUpdate","column","renderHeader","theme","userStyle","styleProps","isAscending","isDescending","icon","iconAscending","iconDescending","headerCell","defaultWidth","cell","_sortColumn","srcObject","columnIndex","_formatColumns","totalWeight","weights","weight","type","name","render","header","_renderColumn","_onResize","arrayOf","object","func"],"mappings":";;AAmBA,OAAOA,KAAP,IAAeC,aAAf,QAAmC,OAAnC;AACA,OAAOC,SAAP,MAAsB,YAAtB;AAEA,OAAOC,SAAP,MAAsB,qBAAtB;AACA,OAAOC,OAAP,MAAoB,kBAApB;AAEA,SAAQC,eAAR,EAAyBC,UAAzB,EAAqCC,QAArC,QAAoD,qBAApD;AAEA,MAAMC,IAAI,GAAG;AACXC,EAAAA,IAAI,EAAE,CADK;AAEXC,EAAAA,MAAM,EAAE,CAFG;AAGXC,EAAAA,OAAO,EAAE;AAHE,CAAb;AAMA,eAAe,MAAMC,WAAN,SAA0BX,aAA1B,CAAwC;AAQrDY,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,UAAMA,KAAN;;AADiB,uCAgCP,MAAM;AAChB,YAAMC,OAAO,GAAG,KAAKC,aAAL,CAAmB,KAAKF,KAAL,CAAWC,OAA9B,CAAhB;AAEAA,MAAAA,OAAO,CAACE,GAAR,CAAY,CAACC,GAAD,EAAMC,QAAN,KAAmB;AAC7B,cAAMC,GAAG,GAAG,KAAKC,MAAL,CAAYF,QAAZ,CAAZ;;AACA,YAAIC,GAAJ,EAAS;AACPF,UAAAA,GAAG,CAACI,KAAJ,GAAYF,GAAG,CAACG,WAAhB;AACD;AACF,OALD;AAOA,WAAKT,KAAL,CAAWU,QAAX,CAAoBT,OAApB;AACD,KA3CkB;;AAAA,yCA6CLU,KAAK,IAAI;AACrB,YAAMV,OAAO,GAAG,KAAKC,aAAL,CAAmB,KAAKF,KAAL,CAAWC,OAA9B,CAAhB;AACA,YAAMW,QAAQ,GAAGX,OAAO,CAACU,KAAD,CAAP,CAAeE,IAAf,KAAwBnB,IAAI,CAACE,MAA7B,GAAsCF,IAAI,CAACG,OAA3C,GAAqDH,IAAI,CAACE,MAA3E;AAEAK,MAAAA,OAAO,CAACa,OAAR,CAAgB,CAACV,GAAD,EAAMC,QAAN,KAAmB;AACjCD,QAAAA,GAAG,CAACS,IAAJ,GAAWR,QAAQ,KAAKM,KAAb,GAAqBC,QAArB,GAAgClB,IAAI,CAACC,IAAhD;AACD,OAFD;AAIA,YAAMoB,UAAU,GAAGH,QAAQ,KAAKlB,IAAI,CAACE,MAAlB,GAA2B,CAA3B,GAA+B,CAAC,CAAnD;;AAEA,YAAMoB,QAAQ,GAAG,CAACC,IAAD,EAAOC,IAAP,KAAgB;AAC/B,eAAOD,IAAI,CAACE,IAAL,CAAUR,KAAV,KAAoBO,IAAI,CAACC,IAAL,CAAUR,KAAV,CAApB,GAAuC,CAACI,UAAxC,GAAqDA,UAA5D;AACD,OAFD;;AAGA,WAAKf,KAAL,CAAWoB,MAAX,CAAkBJ,QAAlB;AAGA,WAAKK,WAAL;AACD,KA9DkB;;AAAA,2CAgEH,CAACC,MAAD,EAASjB,QAAT,KAAsB;AACpC,YAAM;AAACkB,QAAAA,YAAD;AAAeC,QAAAA,KAAf;AAAsBC,QAAAA;AAAtB,UAAmC,KAAKzB,KAA9C;AAEA,YAAM0B,UAAU,GAAG;AACjBF,QAAAA,KADiB;AAEjBG,QAAAA,WAAW,EAAEL,MAAM,CAACT,IAAP,KAAgBnB,IAAI,CAACE,MAFjB;AAGjBgC,QAAAA,YAAY,EAAEN,MAAM,CAACT,IAAP,KAAgBnB,IAAI,CAACG;AAHlB,OAAnB;AAMA,UAAIgC,IAAI,GAAG,IAAX;;AACA,UAAIH,UAAU,CAACC,WAAf,EAA4B;AAC1BE,QAAAA,IAAI,GAAGJ,SAAS,CAACK,aAAV,IAA2B,GAAlC;AACD,OAFD,MAEO,IAAIJ,UAAU,CAACE,YAAf,EAA6B;AAClCC,QAAAA,IAAI,GAAGJ,SAAS,CAACM,cAAV,IAA4B,GAAnC;AACD;;AAED,aACE,oBAAC,UAAD,eACML,UADN;AAEE,QAAA,SAAS,EAAED,SAAS,CAACO,UAFvB;AAGE,QAAA,KAAK,EAAE;AAACxB,UAAAA,KAAK,EAAEc,MAAM,CAACW;AAAf,SAHT;AAIE,QAAA,GAAG,EAAE5B,QAJP;AAKE,QAAA,KAAK,EAAEA,QALT;AAME,QAAA,GAAG,EAAE6B,IAAI,IAAI;AACX,eAAK3B,MAAL,CAAYF,QAAZ,IAAwB6B,IAAxB;AACD,SARH;AASE,QAAA,OAAO,EAAE,MAAM,KAAKC,WAAL,CAAiB9B,QAAjB;AATjB,UAWGkB,YAAY,CAAC;AAACD,QAAAA,MAAM,EAAEA,MAAM,CAACc,SAAhB;AAA2BC,QAAAA,WAAW,EAAEhC;AAAxC,OAAD,CAXf,EAYGwB,IAAI,IACH,oBAAC,QAAD,eAAcH,UAAd;AAA0B,QAAA,SAAS,EAAED,SAAS,CAACZ;AAA/C,UACGgB,IADH,CAbJ,CADF;AAoBD,KApGkB;;AAGjB,SAAK3B,aAAL,GAAqBZ,OAAO,CAAC,KAAKgD,cAAN,CAA5B;AACA,SAAK/B,MAAL,GAAc,EAAd;AACD;;AAED+B,EAAAA,cAAc,CAACrC,OAAD,EAAU;AACtB,QAAIsC,WAAW,GAAG,CAAlB;AACA,UAAMC,OAAO,GAAG,EAAhB;AAEAvC,IAAAA,OAAO,CAACa,OAAR,CAAgB,CAACV,GAAD,EAAMC,QAAN,KAAmB;AACjC,UAAIoC,MAAM,GAAG,CAAb;;AACA,UAAIpC,QAAQ,KAAK,CAAjB,EAAoB;AAClBoC,QAAAA,MAAM;AACP;;AACD,UAAIrC,GAAG,CAACsC,IAAJ,KAAa,QAAjB,EAA2B;AACzBD,QAAAA,MAAM;AACP;;AACDD,MAAAA,OAAO,CAACnC,QAAD,CAAP,GAAoBoC,MAApB;AACAF,MAAAA,WAAW,IAAIE,MAAf;AACD,KAVD;AAYA,WAAOxC,OAAO,CAACE,GAAR,CAAY,CAACC,GAAD,EAAMC,QAAN,MAAoB;AACrC+B,MAAAA,SAAS,EAAEhC,GAD0B;AAErCuC,MAAAA,IAAI,EAAEvC,GAAG,CAACuC,IAF2B;AAGrCD,MAAAA,IAAI,EAAEtC,GAAG,CAACsC,IAH2B;AAIrC7B,MAAAA,IAAI,EAAEnB,IAAI,CAACC,IAJ0B;AAKrCsC,MAAAA,YAAY,YAAM,MAAMM,WAAP,GAAsBC,OAAO,CAACnC,QAAD,CAAlC;AALyB,KAApB,CAAZ,CAAP;AAOD;;AAwEDuC,EAAAA,MAAM,GAAG;AACP,UAAM;AAACpB,MAAAA,KAAD;AAAQC,MAAAA;AAAR,QAAqB,KAAKzB,KAAhC;AACA,UAAMC,OAAO,GAAG,KAAKC,aAAL,CAAmB,KAAKF,KAAL,CAAWC,OAA9B,CAAhB;AAEA,WACE,oBAAC,eAAD;AAAiB,MAAA,KAAK,EAAEuB,KAAxB;AAA+B,MAAA,SAAS,EAAEC,SAAS,CAACoB;AAApD,OACG5C,OAAO,CAACE,GAAR,CAAY,KAAK2C,aAAjB,CADH,EAEE,oBAAC,SAAD;AAAW,MAAA,QAAQ,EAAE,KAAKC,SAA1B;AAAqC,MAAA,YAAY,EAAE;AAAnD,MAFF,CADF;AAMD;;AAxHoD;;gBAAlCjD,W,eACA;AACjBG,EAAAA,OAAO,EAAEb,SAAS,CAAC4D,OAAV,CAAkB5D,SAAS,CAAC6D,MAA5B,CADQ;AAEjB1B,EAAAA,YAAY,EAAEnC,SAAS,CAAC8D,IAFP;AAGjB9B,EAAAA,MAAM,EAAEhC,SAAS,CAAC8D,IAHD;AAIjBxC,EAAAA,QAAQ,EAAEtB,SAAS,CAAC8D;AAJH,C","sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nimport React, {PureComponent} from 'react';\nimport PropTypes from 'prop-types';\n\nimport AutoSizer from '../shared/autosizer';\nimport memoize from '../utils/memoize';\n\nimport {HeaderContainer, HeaderCell, SortIcon} from './styled-components';\n\nconst SORT = {\n  NONE: 0,\n  ASCEND: 1,\n  DESCEND: 2\n};\n\nexport default class TableHeader extends PureComponent {\n  static propTypes = {\n    columns: PropTypes.arrayOf(PropTypes.object),\n    renderHeader: PropTypes.func,\n    onSort: PropTypes.func,\n    onResize: PropTypes.func\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.formatColumns = memoize(this._formatColumns);\n    this._cells = [];\n  }\n\n  _formatColumns(columns) {\n    let totalWeight = 0;\n    const weights = [];\n\n    columns.forEach((col, colIndex) => {\n      let weight = 1;\n      if (colIndex === 0) {\n        weight++;\n      }\n      if (col.type === 'string') {\n        weight++;\n      }\n      weights[colIndex] = weight;\n      totalWeight += weight;\n    });\n\n    return columns.map((col, colIndex) => ({\n      srcObject: col,\n      name: col.name,\n      type: col.type,\n      sort: SORT.NONE,\n      defaultWidth: `${(100 / totalWeight) * weights[colIndex]}%`\n    }));\n  }\n\n  _onResize = () => {\n    const columns = this.formatColumns(this.props.columns);\n\n    columns.map((col, colIndex) => {\n      const ref = this._cells[colIndex];\n      if (ref) {\n        col.width = ref.clientWidth;\n      }\n    });\n\n    this.props.onResize(columns);\n  };\n\n  _sortColumn = index => {\n    const columns = this.formatColumns(this.props.columns);\n    const sortType = columns[index].sort === SORT.ASCEND ? SORT.DESCEND : SORT.ASCEND;\n\n    columns.forEach((col, colIndex) => {\n      col.sort = colIndex === index ? sortType : SORT.NONE;\n    });\n\n    const multiplier = sortType === SORT.ASCEND ? 1 : -1;\n\n    const sortFunc = (row1, row2) => {\n      return row1.data[index] <= row2.data[index] ? -multiplier : multiplier;\n    };\n    this.props.onSort(sortFunc);\n\n    // Trigger rerender\n    this.forceUpdate();\n  };\n\n  _renderColumn = (column, colIndex) => {\n    const {renderHeader, theme, userStyle} = this.props;\n\n    const styleProps = {\n      theme,\n      isAscending: column.sort === SORT.ASCEND,\n      isDescending: column.sort === SORT.DESCEND\n    };\n\n    let icon = null;\n    if (styleProps.isAscending) {\n      icon = userStyle.iconAscending || '↑';\n    } else if (styleProps.isDescending) {\n      icon = userStyle.iconDescending || '↓';\n    }\n\n    return (\n      <HeaderCell\n        {...styleProps}\n        userStyle={userStyle.headerCell}\n        style={{width: column.defaultWidth}}\n        key={colIndex}\n        index={colIndex}\n        ref={cell => {\n          this._cells[colIndex] = cell;\n        }}\n        onClick={() => this._sortColumn(colIndex)}\n      >\n        {renderHeader({column: column.srcObject, columnIndex: colIndex})}\n        {icon && (\n          <SortIcon {...styleProps} userStyle={userStyle.sort}>\n            {icon}\n          </SortIcon>\n        )}\n      </HeaderCell>\n    );\n  };\n\n  render() {\n    const {theme, userStyle} = this.props;\n    const columns = this.formatColumns(this.props.columns);\n\n    return (\n      <HeaderContainer theme={theme} userStyle={userStyle.header}>\n        {columns.map(this._renderColumn)}\n        <AutoSizer onResize={this._onResize} debounceTime={200} />\n      </HeaderContainer>\n    );\n  }\n}\n"],"file":"table-header.js"}