{"version":3,"sources":["../../../src/metric-card/metric-chart.js"],"names":["React","PureComponent","PropTypes","findNearestValue","Chart","memoize","MetricChart","constructor","props","highlightX","data","Number","isFinite","getX","result","key","hasOwnProperty","evt","onClick","state","hoveredX","value","hoveredValues","setState","isHovered","onNearestX","onMouseLeave","getCurrentValues","_getCurrentValues","render","currentValues","_onClick","_onNearestX","_onMouseLeave","Object","assign","number","propTypes","defaultProps"],"mappings":"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","sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nimport React, {PureComponent} from 'react';\nimport PropTypes from 'prop-types';\n\nimport {findNearestValue} from './utils';\nimport Chart from './chart';\nimport memoize from '../utils/memoize';\n\n/**\n * A metric chart draws a chart with optional percentiles and lags\n */\nexport default class MetricChart extends PureComponent {\n  static propTypes = Object.assign(\n    {\n      highlightX: PropTypes.number\n    },\n    Chart.propTypes\n  );\n\n  static defaultProps = Chart.defaultProps;\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      isHovered: false,\n      hoveredX: null,\n      // The nearest data point to the cursor in each series\n      hoveredValues: {}\n    };\n\n    this.getCurrentValues = memoize(this._getCurrentValues);\n  }\n\n  // Find the closest data point in each series to the current time\n  _getCurrentValues = (highlightX, data) => {\n    if (!Number.isFinite(highlightX) || !data) {\n      return null;\n    }\n\n    const {getX} = this.props;\n\n    const result = {};\n    for (const key in data) {\n      if (data.hasOwnProperty(key)) {\n        result[key] = findNearestValue(data[key], highlightX, getX);\n      }\n    }\n    return result;\n  };\n\n  _onClick = evt => {\n    this.props.onClick(this.state.hoveredX, evt);\n  };\n\n  _onNearestX = (key, value, evt) => {\n    const {hoveredValues} = this.state;\n    hoveredValues[key] = value;\n\n    this.setState({\n      isHovered: true,\n      hoveredX: this.props.getX(value),\n      hoveredValues: {...hoveredValues}\n    });\n\n    this.props.onNearestX(key, value, evt);\n  };\n\n  _onMouseLeave = evt => {\n    this.setState({isHovered: false, hoveredX: null});\n    this.props.onMouseLeave(evt);\n  };\n\n  render() {\n    const {highlightX, data} = this.props;\n    const {isHovered, hoveredValues} = this.state;\n    const currentValues = this.getCurrentValues(highlightX, data);\n\n    return (\n      <Chart\n        {...this.props}\n        onClick={this._onClick}\n        onNearestX={this._onNearestX}\n        onMouseLeave={this._onMouseLeave}\n        highlightValues={isHovered ? hoveredValues : currentValues}\n      />\n    );\n  }\n}\n"],"file":"metric-chart.js"}