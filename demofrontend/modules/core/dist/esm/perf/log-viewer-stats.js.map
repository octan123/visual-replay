{"version":3,"sources":["../../../src/perf/log-viewer-stats.js"],"names":["React","MetricCard","MetricChart","HISTORY_SIZE","STATS_NAMES","STYLES","STATS_KEYS","STATS_COLORS","DEFAULT_STATS_TITLE","STATS_HELP","INITIAL_STATS","Help","help","Object","entries","statName","statHelp","push","marginBottom","LOG_VIEWER","_updateStats","stats","statsSnapshot","counter","values","length","slice","newStatValue","x","y","LogViewerStats","nextProps","props","state","setState","data","title","STATS","METRIC_CARD","statKey","Component"],"mappings":"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","sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nimport React from 'react';\nimport {MetricCard, MetricChart} from '@streetscape.gl/monochrome';\n\nimport {\n  HISTORY_SIZE,\n  STATS_NAMES,\n  STYLES,\n  STATS_KEYS,\n  STATS_COLORS,\n  DEFAULT_STATS_TITLE,\n  STATS_HELP,\n  INITIAL_STATS\n} from './constants';\n\nconst Help = () => {\n  const help = [];\n  for (const [statName, statHelp] of Object.entries(STATS_HELP)) {\n    help.push(\n      <div key={statName} style={{marginBottom: 10}}>\n        <strong>{STATS_NAMES[statName]}</strong>\n        <div>{statHelp}</div>\n      </div>\n    );\n  }\n  return <div style={STYLES.LOG_VIEWER.STATS_HELP}>{help}</div>;\n};\n\n/**\n * Stat snapshot at a specific point in time.\n * @typedef {Object} StatsSnapshot\n * @property {Number} STATS_KEYS.FPS\n * @property {Number} STATS_KEYS.REDRAW\n * @property {Number} STATS_KEYS.FRAME_UPDATE\n * @property {Number} STATS_KEYS.LOADER_UPDATE\n * @property {Number} STATS_KEYS.LOADER_ERROR\n */\n\n/**\n * @typedef {Object} StatValue\n * @property {Number} x - X-axis value (e.g. time) for this stat.\n * @property {Number} y - Y-axis value (e.g. value) for this stat.\n */\n\n/**\n * @typedef {Object} Stats - History {StatsSnapshot} over time.\n * @property {Array<StatValue>} STATS_KEYS.FPS\n * @property {Array<StatValue>} STATS_KEYS.REDRAW\n * @property {Array<StatValue>} STATS_KEYS.FRAME_UPDATE\n * @property {Array<StatValue>} STATS_KEYS.LOADER_UPDATE\n * @property {Array<StatValue>} STATS_KEYS.LOADER_ERROR\n * @property {Number} counter\n */\n\n/**\n * Update stats history with a stats snapshot.\n * @param {Stats} stats - Stats history.\n * @param {StatsSnapshot} statsSnapshot - Snapshot used to update stats history.\n */\nconst _updateStats = (stats, statsSnapshot) => {\n  stats.counter += 1;\n\n  for (const statName of Object.values(STATS_KEYS)) {\n    // Drop oldest stat value when we've reached the history size.\n    if (stats[statName].length >= HISTORY_SIZE) {\n      stats[statName] = stats[statName].slice(1);\n    }\n    // Construct new stat value from stats snapshot.\n    const newStatValue = {\n      x: stats.counter,\n      y: (statsSnapshot && statsSnapshot[statName]) || 0\n    };\n    stats[statName].push(newStatValue);\n  }\n  return stats;\n};\n\n/**\n * Component to render the Log Viewer stats. It consumes a stats snapshot.\n * Every time the stats snapshot updates, the stats history is updated and\n * the component renders the updated stats history.\n * @param {Object} props\n * @param {StatsSnapshot} props.statsSnapshot\n */\nexport class LogViewerStats extends React.Component {\n  state = {stats: INITIAL_STATS};\n\n  componentWillUpdate(nextProps) {\n    if (nextProps.statsSnapshot !== this.props.statsSnapshot) {\n      const stats = _updateStats(this.state.stats, nextProps.statsSnapshot);\n      this.setState({stats});\n    }\n  }\n\n  render() {\n    const {counter, ...data} = this.state.stats;\n    const title = this.props.title || DEFAULT_STATS_TITLE;\n    return (\n      <div id=\"stats\" style={STYLES.LOG_VIEWER.STATS}>\n        <MetricCard title={title} description={<Help />} style={STYLES.LOG_VIEWER.METRIC_CARD}>\n          <MetricChart\n            width={350}\n            height={200}\n            data={data}\n            highlightX={counter}\n            getColor={statKey => STATS_COLORS[statKey]}\n            formatTitle={statKey => STATS_NAMES[statKey]}\n          />\n        </MetricCard>\n      </div>\n    );\n  }\n}\n"],"file":"log-viewer-stats.js"}