{"version":3,"sources":["../../../../src/components/log-viewer/index.js"],"names":["React","PureComponent","PropTypes","setObjectState","Core3DViewer","HoverTooltip","connectToLog","DEFAULT_VIEW_STATE","noop","preventDefault","evt","LogViewer","constructor","props","viewState","viewOffset","setState","onViewStateChange","info","showTooltip","object","hoverInfo","state","onClick","objectId","id","onSelectObject","objectStates","isObjectSelected","selected","stateName","value","onObjectStateChange","onContextMenu","width","height","longitude","latitude","viewMode","initialViewState","x","y","bearing","_renderTooltip","style","renderTooltip","tooltip","render","_onViewStateChange","_onClickObject","_onHoverObject","_onContextMenu","propTypes","func","defaultProps","getTransformMatrix","streamName","context","getLogState","log","frame","getCurrentFrame","metadata","getMetadata","streamsMetadata","getStreamsMetadata","Component"],"mappings":";;;;;;;AAoBA,OAAOA,KAAP,IAAeC,aAAf,QAAmC,OAAnC;AACA,OAAOC,SAAP,MAAsB,YAAtB;AAEA,SAAQC,cAAR,QAA6B,0BAA7B;AAEA,OAAOC,YAAP,MAAyB,kBAAzB;AACA,OAAOC,YAAP,MAAyB,iBAAzB;AAEA,OAAOC,YAAP,MAAyB,YAAzB;AACA,SAAQC,kBAAR,QAAiC,iBAAjC;;AAEA,MAAMC,IAAI,GAAG,MAAM,CAAE,CAArB;;AACA,MAAMC,cAAc,GAAGC,GAAG,IAAIA,GAAG,CAACD,cAAJ,EAA9B;;AAEA,MAAME,SAAN,SAAwBV,aAAxB,CAAsC;AA+BpCW,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,UAAMA,KAAN;;AADiB,gDAsBE,CAAC;AAACC,MAAAA,SAAD;AAAYC,MAAAA;AAAZ,KAAD,KAA6B;AAChD,WAAKC,QAAL,CAAc;AAACF,QAAAA,SAAD;AAAYC,QAAAA;AAAZ,OAAd;AACA,WAAKF,KAAL,CAAWI,iBAAX,CAA6B;AAACH,QAAAA,SAAD;AAAYC,QAAAA;AAAZ,OAA7B;AACD,KAzBkB;;AAAA,4CA2BF,CAACG,IAAD,EAAOR,GAAP,KAAe;AAC9B,UAAI,KAAKG,KAAL,CAAWM,WAAX,IAA0BD,IAA1B,IAAkCA,IAAI,CAACE,MAA3C,EAAmD;AACjD,aAAKJ,QAAL,CAAc;AAACK,UAAAA,SAAS,EAAEH;AAAZ,SAAd;AACD,OAFD,MAEO,IAAI,KAAKI,KAAL,CAAWD,SAAf,EAA0B;AAC/B,aAAKL,QAAL,CAAc;AAACK,UAAAA,SAAS,EAAE;AAAZ,SAAd;AACD;AACF,KAjCkB;;AAAA,4CAmCF,CAACH,IAAD,EAAOR,GAAP,KAAe;AAC9B,WAAKG,KAAL,CAAWU,OAAX,CAAmBL,IAAnB,EAAyBR,GAAzB;AACA,YAAMc,QAAQ,GAAGN,IAAI,IAAIA,IAAI,CAACE,MAAb,IAAuBF,IAAI,CAACE,MAAL,CAAYK,EAApD;;AAEA,UAAID,QAAQ,IAAI,CAAC,KAAKX,KAAL,CAAWa,cAAX,CAA0BR,IAA1B,EAAgCR,GAAhC,CAAjB,EAAuD;AAGrD,YAAI;AAACiB,UAAAA;AAAD,YAAiB,KAAKL,KAA1B;AACA,cAAMM,gBAAgB,GAAGD,YAAY,CAACE,QAAb,IAAyBF,YAAY,CAACE,QAAb,CAAsBL,QAAtB,CAAlD;AAEAG,QAAAA,YAAY,GAAGxB,cAAc,CAACwB,YAAD,EAAe;AAC1CG,UAAAA,SAAS,EAAE,UAD+B;AAE1CL,UAAAA,EAAE,EAAED,QAFsC;AAG1CO,UAAAA,KAAK,EAAE,CAACH;AAHkC,SAAf,CAA7B;AAMA,aAAKZ,QAAL,CAAc;AAACW,UAAAA;AAAD,SAAd;AACA,aAAKd,KAAL,CAAWmB,mBAAX,CAA+BL,YAA/B;AACD;AACF,KAtDkB;;AAAA,4CAwDF,CAACT,IAAD,EAAOR,GAAP,KAAe;AAC9B,WAAKG,KAAL,CAAWoB,aAAX,CAAyBf,IAAzB,EAA+BR,GAA/B;AACD,KA1DkB;;AAGjB,SAAKY,KAAL,GAAa;AACXR,MAAAA,SAAS;AACPoB,QAAAA,KAAK,EAAE,CADA;AAEPC,QAAAA,MAAM,EAAE,CAFD;AAGPC,QAAAA,SAAS,EAAE,CAHJ;AAIPC,QAAAA,QAAQ,EAAE;AAJH,SAKJ9B,kBALI,GAMJM,KAAK,CAACyB,QAAN,CAAeC,gBANX,CADE;AASXxB,MAAAA,UAAU,EAAE;AACVyB,QAAAA,CAAC,EAAE,CADO;AAEVC,QAAAA,CAAC,EAAE,CAFO;AAGVC,QAAAA,OAAO,EAAE;AAHC,OATD;AAcXf,MAAAA,YAAY,EAAE,EAdH;AAeXN,MAAAA,SAAS,EAAE;AAfA,KAAb;AAiBD;;AAwCDsB,EAAAA,cAAc,GAAG;AACf,UAAM;AAACxB,MAAAA,WAAD;AAAcyB,MAAAA,KAAd;AAAqBC,MAAAA;AAArB,QAAsC,KAAKhC,KAAjD;AACA,UAAM;AAACQ,MAAAA;AAAD,QAAc,KAAKC,KAAzB;AAEA,WACEH,WAAW,IACXE,SADA,IAEE,oBAAC,YAAD;AAAc,MAAA,IAAI,EAAEA,SAApB;AAA+B,MAAA,KAAK,EAAEuB,KAAK,CAACE,OAA5C;AAAqD,MAAA,aAAa,EAAED;AAApE,MAHJ;AAMD;;AAEDE,EAAAA,MAAM,GAAG;AACP,UAAMjC,SAAS,GAAG,KAAKD,KAAL,CAAWC,SAAX,IAAwB,KAAKQ,KAAL,CAAWR,SAArD;AACA,UAAMC,UAAU,GAAG,KAAKF,KAAL,CAAWE,UAAX,IAAyB,KAAKO,KAAL,CAAWP,UAAvD;AACA,UAAMY,YAAY,GAAG,KAAKd,KAAL,CAAWc,YAAX,IAA2B,KAAKL,KAAL,CAAWK,YAA3D;AAEA,WACE;AAAK,MAAA,aAAa,EAAElB;AAApB,OACE,oBAAC,YAAD,eACM,KAAKI,KADX;AAEE,MAAA,iBAAiB,EAAE,KAAKmC,kBAF1B;AAGE,MAAA,OAAO,EAAE,KAAKC,cAHhB;AAIE,MAAA,OAAO,EAAE,KAAKC,cAJhB;AAKE,MAAA,aAAa,EAAE,KAAKC,cALtB;AAME,MAAA,SAAS,EAAErC,SANb;AAOE,MAAA,UAAU,EAAEC,UAPd;AAQE,MAAA,YAAY,EAAEY;AARhB,QAUG,KAAKgB,cAAL,EAVH,CADF,CADF;AAgBD;;AA5HmC;;gBAAhChC,S,+CAECP,YAAY,CAACgD,S;AAGhBP,EAAAA,aAAa,EAAE3C,SAAS,CAACmD,I;AACzBT,EAAAA,KAAK,EAAE1C,SAAS,CAACkB,M;AAGjBM,EAAAA,cAAc,EAAExB,SAAS,CAACmD,I;AAC1BpB,EAAAA,aAAa,EAAE/B,SAAS,CAACmD,I;AACzBpC,EAAAA,iBAAiB,EAAEf,SAAS,CAACmD,I;AAC7BrB,EAAAA,mBAAmB,EAAE9B,SAAS,CAACmD,I;AAG/BvC,EAAAA,SAAS,EAAEZ,SAAS,CAACkB,M;AACrBL,EAAAA,UAAU,EAAEb,SAAS,CAACkB,M;AACtBO,EAAAA,YAAY,EAAEzB,SAAS,CAACkB;;;gBAjBtBT,S,kDAqBCP,YAAY,CAACkD,Y;AAEhBV,EAAAA,KAAK,EAAE,E;AACP3B,EAAAA,iBAAiB,EAAET,I;AACnBwB,EAAAA,mBAAmB,EAAExB,I;AACrBkB,EAAAA,cAAc,EAAElB,I;AAChByB,EAAAA,aAAa,EAAEzB,I;AACf+C,EAAAA,kBAAkB,EAAE,CAACC,UAAD,EAAaC,OAAb,KAAyB;;;AAmGjD,MAAMC,WAAW,GAAGC,GAAG,KAAK;AAC1BC,EAAAA,KAAK,EAAED,GAAG,CAACE,eAAJ,EADmB;AAE1BC,EAAAA,QAAQ,EAAEH,GAAG,CAACI,WAAJ,EAFgB;AAG1BC,EAAAA,eAAe,EAAEL,GAAG,CAACM,kBAAJ;AAHS,CAAL,CAAvB;;AAMA,eAAe3D,YAAY,CAAC;AAACoD,EAAAA,WAAD;AAAcQ,EAAAA,SAAS,EAAEvD;AAAzB,CAAD,CAA3B","sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport React, {PureComponent} from 'react';\nimport PropTypes from 'prop-types';\n\nimport {setObjectState} from '../../utils/object-state';\n\nimport Core3DViewer from './core-3d-viewer';\nimport HoverTooltip from './hover-tooltip';\n\nimport connectToLog from '../connect';\nimport {DEFAULT_VIEW_STATE} from '../../constants';\n\nconst noop = () => {};\nconst preventDefault = evt => evt.preventDefault();\n\nclass LogViewer extends PureComponent {\n  static propTypes = {\n    ...Core3DViewer.propTypes,\n\n    // Rendering options\n    renderTooltip: PropTypes.func,\n    style: PropTypes.object,\n\n    // Callbacks\n    onSelectObject: PropTypes.func,\n    onContextMenu: PropTypes.func,\n    onViewStateChange: PropTypes.func,\n    onObjectStateChange: PropTypes.func,\n\n    // Optional: to use with external state management (e.g. Redux)\n    viewState: PropTypes.object,\n    viewOffset: PropTypes.object,\n    objectStates: PropTypes.object\n  };\n\n  static defaultProps = {\n    ...Core3DViewer.defaultProps,\n\n    style: {},\n    onViewStateChange: noop,\n    onObjectStateChange: noop,\n    onSelectObject: noop,\n    onContextMenu: noop,\n    getTransformMatrix: (streamName, context) => null\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      viewState: {\n        width: 1,\n        height: 1,\n        longitude: 0,\n        latitude: 0,\n        ...DEFAULT_VIEW_STATE,\n        ...props.viewMode.initialViewState\n      },\n      viewOffset: {\n        x: 0,\n        y: 0,\n        bearing: 0\n      },\n      objectStates: {},\n      hoverInfo: null\n    };\n  }\n\n  _onViewStateChange = ({viewState, viewOffset}) => {\n    this.setState({viewState, viewOffset});\n    this.props.onViewStateChange({viewState, viewOffset});\n  };\n\n  _onHoverObject = (info, evt) => {\n    if (this.props.showTooltip && info && info.object) {\n      this.setState({hoverInfo: info});\n    } else if (this.state.hoverInfo) {\n      this.setState({hoverInfo: null});\n    }\n  };\n\n  _onClickObject = (info, evt) => {\n    this.props.onClick(info, evt);\n    const objectId = info && info.object && info.object.id;\n\n    if (objectId && !this.props.onSelectObject(info, evt)) {\n      // User callback did not mark event as handled, proceed with default behavior\n      // Select object\n      let {objectStates} = this.state;\n      const isObjectSelected = objectStates.selected && objectStates.selected[objectId];\n\n      objectStates = setObjectState(objectStates, {\n        stateName: 'selected',\n        id: objectId,\n        value: !isObjectSelected\n      });\n\n      this.setState({objectStates});\n      this.props.onObjectStateChange(objectStates);\n    }\n  };\n\n  _onContextMenu = (info, evt) => {\n    this.props.onContextMenu(info, evt);\n  };\n\n  _renderTooltip() {\n    const {showTooltip, style, renderTooltip} = this.props;\n    const {hoverInfo} = this.state;\n\n    return (\n      showTooltip &&\n      hoverInfo && (\n        <HoverTooltip info={hoverInfo} style={style.tooltip} renderContent={renderTooltip} />\n      )\n    );\n  }\n\n  render() {\n    const viewState = this.props.viewState || this.state.viewState;\n    const viewOffset = this.props.viewOffset || this.state.viewOffset;\n    const objectStates = this.props.objectStates || this.state.objectStates;\n\n    return (\n      <div onContextMenu={preventDefault}>\n        <Core3DViewer\n          {...this.props}\n          onViewStateChange={this._onViewStateChange}\n          onClick={this._onClickObject}\n          onHover={this._onHoverObject}\n          onContextMenu={this._onContextMenu}\n          viewState={viewState}\n          viewOffset={viewOffset}\n          objectStates={objectStates}\n        >\n          {this._renderTooltip()}\n        </Core3DViewer>\n      </div>\n    );\n  }\n}\n\nconst getLogState = log => ({\n  frame: log.getCurrentFrame(),\n  metadata: log.getMetadata(),\n  streamsMetadata: log.getStreamsMetadata()\n});\n\nexport default connectToLog({getLogState, Component: LogViewer});\n"],"file":"index.js"}