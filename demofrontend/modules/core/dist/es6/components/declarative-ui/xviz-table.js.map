{"version":3,"sources":["../../../../src/components/declarative-ui/xviz-table.js"],"names":["React","PureComponent","Table","TreeTable","Tooltip","PropTypes","connectToLog","XVIZTableComponent","constructor","props","state","_formatData","componentWillReceiveProps","nextProps","columns","nodes","setState","displayObjectId","map","col","name","display_text","type","rowIds","rows","forEach","node","row","data","column_values","children","id","hasOwnProperty","parent","undefined","push","parentRow","render","title","description","width","height","style","renderHeader","renderCell","indentSize","Component","oneOfType","string","number","object","func","stream","bool","array","column","value","String","getLogState","log","ownProps","frame","getCurrentFrame","streams","treetable"],"mappings":"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","sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport React, {PureComponent} from 'react';\nimport {Table, TreeTable, Tooltip} from '@streetscape.gl/monochrome';\nimport PropTypes from 'prop-types';\n\nimport connectToLog from '../connect';\n\nclass XVIZTableComponent extends PureComponent {\n  static propTypes = {\n    // UI configuration\n    width: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n    height: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n    style: PropTypes.object,\n    renderHeader: PropTypes.func,\n    renderCell: PropTypes.func,\n    indentSize: PropTypes.number,\n\n    // From declarative UI table component\n    stream: PropTypes.string,\n    title: PropTypes.string,\n    description: PropTypes.string,\n    displayObjectId: PropTypes.bool,\n\n    // From connected log\n    columns: PropTypes.array,\n    nodes: PropTypes.array\n  };\n\n  static defaultProps = {\n    width: '100%',\n    height: 400,\n    style: {},\n    indentSize: 12,\n    renderHeader: ({column}) => column.name,\n    renderCell: ({value}) => (value === null ? null : String(value))\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      ...this._formatData(props)\n    };\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.columns !== this.props.columns || nextProps.nodes !== this.props.nodes) {\n      this.setState(this._formatData(nextProps));\n    }\n  }\n\n  _formatData({columns, nodes, displayObjectId}) {\n    if (!columns || !nodes) {\n      return {columns: null};\n    }\n\n    columns = columns.map(col => ({\n      name: col.display_text,\n      type: col.type\n    }));\n\n    const rowIds = {};\n    const rows = [];\n\n    nodes.forEach(node => {\n      const row = {\n        data: node.column_values || [],\n        children: []\n      };\n      rowIds[node.id] = row;\n\n      // Validate the property is on the instance, and not just in the\n      // prototype chain. This comes from how protobuf.js implements messages\n      if (!node.hasOwnProperty('parent') || node.parent === undefined) {\n        rows.push(row);\n      } else {\n        const parentRow = rowIds[node.parent];\n        if (parentRow) {\n          parentRow.children.push(row);\n        }\n      }\n    });\n\n    return {columns, rows};\n  }\n\n  render() {\n    const {columns, rows} = this.state;\n\n    if (!columns) {\n      // TODO - show loading message\n      return null;\n    }\n\n    const {\n      title,\n      description,\n      width,\n      height,\n      style,\n      renderHeader,\n      renderCell,\n      indentSize,\n      type\n    } = this.props;\n    const Component = type === 'table' ? Table : TreeTable;\n\n    return (\n      <div style={{width, height}}>\n        <Tooltip content={description}>\n          <h4>{title}</h4>\n        </Tooltip>\n        <Component\n          width=\"100%\"\n          height=\"100%\"\n          style={style}\n          renderHeader={renderHeader}\n          renderCell={renderCell}\n          indentSize={indentSize}\n          columns={columns}\n          rows={rows}\n        />\n      </div>\n    );\n  }\n}\n\nconst getLogState = (log, ownProps) => {\n  const frame = log.getCurrentFrame();\n  const data = frame && frame.streams[ownProps.stream];\n  return data && data.treetable;\n};\n\nexport default connectToLog({getLogState, Component: XVIZTableComponent});\n"],"file":"xviz-table.js"}