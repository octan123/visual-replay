{"version":3,"sources":["../../../src/parsers/parse-xviz-message.js"],"names":["parseXVIZMessageSync","postDeserialize","getWorkerFarm","initializeWorkerFarm","initializeWorkers","id","worker","maxConcurrency","capacity","parseXVIZMessage","message","onResult","onError","debug","workerId","opts","workerFarm","onMessage","data","process"],"mappings":"AAcA,SAAQA,oBAAR,QAAmC,2BAAnC;AACA,SAAQC,eAAR,QAA8B,aAA9B;AACA,SAAQC,aAAR,EAAuBC,oBAAvB,QAAkD,iCAAlD;AAGA,OAAO,SAASC,iBAAT,CAA2B;AAACC,EAAAA,EAAD;AAAKC,EAAAA,MAAL;AAAaC,EAAAA,cAAc,GAAG,CAA9B;AAAiCC,EAAAA,QAAQ,GAAG;AAA5C,CAA3B,EAA8E;AACnFL,EAAAA,oBAAoB,CAAC;AAACE,IAAAA,EAAD;AAAKC,IAAAA,MAAL;AAAaC,IAAAA,cAAb;AAA6BC,IAAAA;AAA7B,GAAD,CAApB;AACD;AAED,OAAO,SAASC,gBAAT,CAA0B;AAC/BC,EAAAA,OAD+B;AAG/BC,EAAAA,QAH+B;AAI/BC,EAAAA,OAJ+B;AAK/BC,EAAAA,KAL+B;AAO/BP,EAAAA,MAAM,GAAG,KAPsB;AAQ/BQ,EAAAA,QAAQ,GAAG,SARoB;AAS/BP,EAAAA,cAAc,GAAG,CATc;AAU/BC,EAAAA,QAAQ,GAAG,IAVoB;AAW/BO,EAAAA,IAAI,GAAG;AAXwB,CAA1B,EAYJ;AACD,MAAIT,MAAJ,EAAY;AACV,UAAMD,EAAE,GAAGS,QAAX;;AACA,QAAI,CAACZ,aAAa,CAACG,EAAD,CAAlB,EAAwB;AACtBD,MAAAA,iBAAiB,CAAC;AAACC,QAAAA,EAAD;AAAKC,QAAAA,MAAL;AAAaC,QAAAA,cAAb;AAA6BC,QAAAA;AAA7B,OAAD,CAAjB;AACD;;AAED,UAAMQ,UAAU,GAAGd,aAAa,CAACG,EAAD,CAAhC;;AAEA,QAAIQ,KAAJ,EAAW;AACTG,MAAAA,UAAU,CAACH,KAAX,GAAmBA,KAAnB;AACD;;AAED,UAAMI,SAAS,GAAGC,IAAI,IAAIP,QAAQ,CAACV,eAAe,CAACiB,IAAD,CAAhB,CAAlC;;AACAF,IAAAA,UAAU,CAACG,OAAX,CAAmB;AAACD,MAAAA,IAAI,EAAER,OAAP;AAAgBK,MAAAA;AAAhB,KAAnB,EAA0CE,SAA1C,EAAqDL,OAArD;AACD,GAdD,MAcO;AACLZ,IAAAA,oBAAoB,CAACU,OAAD,EAAUC,QAAV,EAAoBC,OAApB,EAA6BG,IAA7B,CAApB;AACD;AACF","sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport {parseXVIZMessageSync} from './parse-xviz-message-sync';\nimport {postDeserialize} from './serialize';\nimport {getWorkerFarm, initializeWorkerFarm} from './parse-xviz-message-workerfarm';\n\n// Public function for initializing workers\nexport function initializeWorkers({id, worker, maxConcurrency = 4, capacity = null}) {\n  initializeWorkerFarm({id, worker, maxConcurrency, capacity});\n}\n\nexport function parseXVIZMessage({\n  message,\n  // callbacks\n  onResult,\n  onError,\n  debug,\n  // worker options\n  worker = false,\n  workerId = 'default',\n  maxConcurrency = 4,\n  capacity = null,\n  opts = {}\n}) {\n  if (worker) {\n    const id = workerId;\n    if (!getWorkerFarm(id)) {\n      initializeWorkers({id, worker, maxConcurrency, capacity});\n    }\n\n    const workerFarm = getWorkerFarm(id);\n\n    if (debug) {\n      workerFarm.debug = debug;\n    }\n\n    const onMessage = data => onResult(postDeserialize(data));\n    workerFarm.process({data: message, opts}, onMessage, onError);\n  } else {\n    parseXVIZMessageSync(message, onResult, onError, opts);\n  }\n}\n"],"file":"parse-xviz-message.js"}