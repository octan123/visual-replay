{"version":3,"sources":["../../../src/parsers/parse-xviz-message.js"],"names":["parseXVIZMessageSync","postDeserialize","getWorkerFarm","initializeWorkerFarm","initializeWorkers","id","worker","maxConcurrency","capacity","parseXVIZMessage","message","onResult","onError","debug","workerId","opts","workerFarm","onMessage","data","process"],"mappings":"AAcA,SAAQA,oBAAR,QAAmC,2BAAnC;AACA,SAAQC,eAAR,QAA8B,aAA9B;AACA,SAAQC,aAAR,EAAuBC,oBAAvB,QAAkD,iCAAlD;AAGA,OAAO,SAASC,iBAAT,OAA8E;AAAA,MAAlDC,EAAkD,QAAlDA,EAAkD;AAAA,MAA9CC,MAA8C,QAA9CA,MAA8C;AAAA,iCAAtCC,cAAsC;AAAA,MAAtCA,cAAsC,oCAArB,CAAqB;AAAA,2BAAlBC,QAAkB;AAAA,MAAlBA,QAAkB,8BAAP,IAAO;AACnFL,EAAAA,oBAAoB,CAAC;AAACE,IAAAA,EAAE,EAAFA,EAAD;AAAKC,IAAAA,MAAM,EAANA,MAAL;AAAaC,IAAAA,cAAc,EAAdA,cAAb;AAA6BC,IAAAA,QAAQ,EAARA;AAA7B,GAAD,CAApB;AACD;AAED,OAAO,SAASC,gBAAT,QAYJ;AAAA,MAXDC,OAWC,SAXDA,OAWC;AAAA,MATDC,QASC,SATDA,QASC;AAAA,MARDC,OAQC,SARDA,OAQC;AAAA,MAPDC,KAOC,SAPDA,KAOC;AAAA,2BALDP,MAKC;AAAA,MALDA,MAKC,6BALQ,KAKR;AAAA,6BAJDQ,QAIC;AAAA,MAJDA,QAIC,+BAJU,SAIV;AAAA,mCAHDP,cAGC;AAAA,MAHDA,cAGC,qCAHgB,CAGhB;AAAA,6BAFDC,QAEC;AAAA,MAFDA,QAEC,+BAFU,IAEV;AAAA,yBADDO,IACC;AAAA,MADDA,IACC,2BADM,EACN;;AACD,MAAIT,MAAJ,EAAY;AACV,QAAMD,EAAE,GAAGS,QAAX;;AACA,QAAI,CAACZ,aAAa,CAACG,EAAD,CAAlB,EAAwB;AACtBD,MAAAA,iBAAiB,CAAC;AAACC,QAAAA,EAAE,EAAFA,EAAD;AAAKC,QAAAA,MAAM,EAANA,MAAL;AAAaC,QAAAA,cAAc,EAAdA,cAAb;AAA6BC,QAAAA,QAAQ,EAARA;AAA7B,OAAD,CAAjB;AACD;;AAED,QAAMQ,UAAU,GAAGd,aAAa,CAACG,EAAD,CAAhC;;AAEA,QAAIQ,KAAJ,EAAW;AACTG,MAAAA,UAAU,CAACH,KAAX,GAAmBA,KAAnB;AACD;;AAED,QAAMI,SAAS,GAAG,SAAZA,SAAY,CAAAC,IAAI;AAAA,aAAIP,QAAQ,CAACV,eAAe,CAACiB,IAAD,CAAhB,CAAZ;AAAA,KAAtB;;AACAF,IAAAA,UAAU,CAACG,OAAX,CAAmB;AAACD,MAAAA,IAAI,EAAER,OAAP;AAAgBK,MAAAA,IAAI,EAAJA;AAAhB,KAAnB,EAA0CE,SAA1C,EAAqDL,OAArD;AACD,GAdD,MAcO;AACLZ,IAAAA,oBAAoB,CAACU,OAAD,EAAUC,QAAV,EAAoBC,OAApB,EAA6BG,IAA7B,CAApB;AACD;AACF","sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport {parseXVIZMessageSync} from './parse-xviz-message-sync';\nimport {postDeserialize} from './serialize';\nimport {getWorkerFarm, initializeWorkerFarm} from './parse-xviz-message-workerfarm';\n\n// Public function for initializing workers\nexport function initializeWorkers({id, worker, maxConcurrency = 4, capacity = null}) {\n  initializeWorkerFarm({id, worker, maxConcurrency, capacity});\n}\n\nexport function parseXVIZMessage({\n  message,\n  // callbacks\n  onResult,\n  onError,\n  debug,\n  // worker options\n  worker = false,\n  workerId = 'default',\n  maxConcurrency = 4,\n  capacity = null,\n  opts = {}\n}) {\n  if (worker) {\n    const id = workerId;\n    if (!getWorkerFarm(id)) {\n      initializeWorkers({id, worker, maxConcurrency, capacity});\n    }\n\n    const workerFarm = getWorkerFarm(id);\n\n    if (debug) {\n      workerFarm.debug = debug;\n    }\n\n    const onMessage = data => onResult(postDeserialize(data));\n    workerFarm.process({data: message, opts}, onMessage, onError);\n  } else {\n    parseXVIZMessageSync(message, onResult, onError, opts);\n  }\n}\n"],"file":"parse-xviz-message.js"}