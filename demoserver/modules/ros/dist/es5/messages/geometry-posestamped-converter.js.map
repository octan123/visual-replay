{"version":3,"sources":["../../../src/messages/geometry-posestamped-converter.js"],"names":["GeometryPoseStamped","config","frame","xvizBuilder","msg","topic","length","timestamp","message","rotation","pose","orientation","position","poseBuilder","xvizStream","x","y","roll","pitch","yaw","TimeUtil","toDate","getTime","origin","mapOrigin","longitude","latitude","altitude","xvizMetaBuilder","stream","category","Converter"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAaA;;AACA;;AACA;;;;;;IAEaA,mB;;;;;AACX,+BAAYC,MAAZ,EAAoB;AAAA;AAAA,6BACZA,MADY;AAEnB;;;;;6GAUoBC,K,EAAOC,W;;;;;;;AACpBC,gBAAAA,G,GAAMF,KAAK,CAAC,KAAKG,KAAN,C;;oBACZD,G;;;;;;;;uBAIwBA,GAAG,CAACA,GAAG,CAACE,MAAJ,GAAa,CAAd,C,EAAzBC,S,QAAAA,S,EAAWC,O,QAAAA,O;AAMZC,gBAAAA,Q,GAAW,mCAAkBD,OAAO,CAACE,IAAR,CAAaC,WAA/B,C;AACVC,gBAAAA,Q,GAAYJ,OAAO,CAACE,I,CAApBE,Q;AACDC,gBAAAA,W,GAAcV,WAAW,CAC5BO,IADiB,CACZ,KAAKI,UADO,EAEjBF,QAFiB,CAERA,QAAQ,CAACG,CAFD,EAEIH,QAAQ,CAACI,CAFb,EAEgB,CAFhB,EAGjBL,WAHiB,CAGLF,QAAQ,CAACQ,IAHJ,EAGUR,QAAQ,CAACS,KAHnB,EAG0BT,QAAQ,CAACU,GAHnC,EAIjBZ,SAJiB,CAIPa,iBAASC,MAAT,CAAgBd,SAAhB,EAA2Be,OAA3B,KAAuC,GAJhC,C;;AAMpB,oBAAI,KAAKrB,MAAL,CAAYsB,MAAhB,EAAwB;AACfA,kBAAAA,MADe,GACL,KAAKtB,MADA,CACfsB,MADe;AAEtBV,kBAAAA,WAAW,CAACW,SAAZ,CAAsBD,MAAM,CAACE,SAA7B,EAAwCF,MAAM,CAACG,QAA/C,EAAyDH,MAAM,CAACI,QAAhE;AACD;;;;;;;;;;;;;;;;;;gCAGSC,e,EAAiB;AAC3BA,MAAAA,eAAe,CAACC,MAAhB,CAAuB,KAAKf,UAA5B,EAAwCgB,QAAxC,CAAiD,MAAjD;AACD;;;wBApCiB;AAChB,aAAO,qBAAP;AACD;;;wBAEwB;AACvB,aAAO,2BAAP;AACD;;;EAXsCC,qB","sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nimport Converter from './converter';\nimport {quaternionToEuler} from '../common/quaternion';\nimport {TimeUtil} from 'rosbag';\n\nexport class GeometryPoseStamped extends Converter {\n  constructor(config) {\n    super(config);\n  }\n\n  static get name() {\n    return 'GeometryPoseStamped';\n  }\n\n  static get messageType() {\n    return 'geometry_msgs/PoseStamped';\n  }\n\n  async convertMessage(frame, xvizBuilder) {\n    const msg = frame[this.topic];\n    if (!msg) {\n      return;\n    }\n\n    const {timestamp, message} = msg[msg.length - 1];\n\n    // Every frame *MUST* have a pose. The pose can be considered\n    // the core reference point for other data and usually drives the timing\n    // of the system.\n    // Position, decimal degrees\n    const rotation = quaternionToEuler(message.pose.orientation);\n    const {position} = message.pose;\n    const poseBuilder = xvizBuilder\n      .pose(this.xvizStream)\n      .position(position.x, position.y, 0)\n      .orientation(rotation.roll, rotation.pitch, rotation.yaw)\n      .timestamp(TimeUtil.toDate(timestamp).getTime() / 1e3);\n\n    if (this.config.origin) {\n      const {origin} = this.config;\n      poseBuilder.mapOrigin(origin.longitude, origin.latitude, origin.altitude);\n    }\n  }\n\n  getMetadata(xvizMetaBuilder) {\n    xvizMetaBuilder.stream(this.xvizStream).category('pose');\n  }\n}\n"],"file":"geometry-posestamped-converter.js"}