{"version":3,"sources":["../../../src/cmds/bagdump.js"],"names":["bagdumpArgs","inArgs","cmd","command","StartEndOptions","topic","alias","description","dumpTime","type","dumpTopics","dumpMessages","dumpDefs","bagdumpCmd","args","source","bag","mainTopic","console","log","TimeUtil","toDate","startTime","getTime","endTime","seen","conn","connections","messageDefinition","readMessages","message","JSON","stringify"],"mappings":";;;;;;;;;;;;;;;;AAeA;;AACA;;;;;;AAEO,SAASA,WAAT,CAAqBC,MAArB,EAA6B;AAClC,MAAMC,GAAG,GAAG,eAAZ;AAEA,SAAOD,MAAM,CAACE,OAAP,CACLD,GADK,EAEL,qCAFK,kCAIAE,uBAJA;AAKHC,IAAAA,KAAK,EAAE;AACLC,MAAAA,KAAK,EAAE,GADF;AAELC,MAAAA,WAAW,EAAE;AAFR,KALJ;AASHC,IAAAA,QAAQ,EAAE;AACRC,MAAAA,IAAI,EAAE,SADE;AAERF,MAAAA,WAAW,EAAE;AAFL,KATP;AAaHG,IAAAA,UAAU,EAAE;AACVD,MAAAA,IAAI,EAAE,SADI;AAEVF,MAAAA,WAAW,EAAE;AAFH,KAbT;AAiBHI,IAAAA,YAAY,EAAE;AACZF,MAAAA,IAAI,EAAE,SADM;AAEZF,MAAAA,WAAW,EAAE;AAFD,KAjBX;AAqBHK,IAAAA,QAAQ,EAAE;AACRH,MAAAA,IAAI,EAAE,SADE;AAERF,MAAAA,WAAW,EAAE;AAFL;AArBP,MA0BLM,UA1BK,CAAP;AA4BD;;SAEqBA,U;;;;;gFAAf,iBAA0BC,IAA1B;AAAA;;AAAA;AAAA;AAAA;AAAA;AACOC,YAAAA,MADP,GACmCD,IADnC,CACEE,GADF,EACsBC,SADtB,GACmCH,IADnC,CACeT,KADf;AAAA;AAAA,mBAGa,kBAAKU,MAAL,CAHb;;AAAA;AAGCC,YAAAA,GAHD;;AAKL,gBAAIF,IAAI,CAACN,QAAT,EAAmB;AACjBU,cAAAA,OAAO,CAACC,GAAR,uBAA2BC,iBAASC,MAAT,CAAgBL,GAAG,CAACM,SAApB,EAA+BC,OAA/B,KAA2C,GAAtE;AACAL,cAAAA,OAAO,CAACC,GAAR,qBAAyBC,iBAASC,MAAT,CAAgBL,GAAG,CAACQ,OAApB,EAA6BD,OAA7B,KAAyC,GAAlE;AACD;;AAED,gBAAIT,IAAI,CAACJ,UAAT,EAAqB;AACbe,cAAAA,IADa,GACN,EADM;;AAEnB,mBAAWC,IAAX,IAAmBV,GAAG,CAACW,WAAvB,EAAoC;AAAA,wCACOX,GAAG,CAACW,WAAJ,CAAgBD,IAAhB,CADP,EAC3BE,iBAD2B,yBAC3BA,iBAD2B,EACRvB,KADQ,yBACRA,KADQ,EACDI,IADC,yBACDA,IADC;;AAGlC,oBAAI,CAACgB,IAAI,CAACpB,KAAD,CAAT,EAAkB;AAChBoB,kBAAAA,IAAI,CAACpB,KAAD,CAAJ,GAAc,IAAd;AAEAa,kBAAAA,OAAO,CAACC,GAAR,CAAYd,KAAZ,EAAmBI,IAAnB;;AACA,sBAAIK,IAAI,CAACF,QAAT,EAAmB;AACjBM,oBAAAA,OAAO,CAACC,GAAR,CAAYS,iBAAZ;AACD;AACF;AACF;AACF;;AAxBI,iBA0BDd,IAAI,CAACH,YA1BJ;AAAA;AAAA;AAAA;;AAAA;AAAA,mBA2BGK,GAAG,CAACa,YAAJ,CAAiB,EAAjB,EAAqB,gBAAsB;AAAA,kBAApBxB,KAAoB,QAApBA,KAAoB;AAAA,kBAAbyB,OAAa,QAAbA,OAAa;;AAC/C,kBAAI,CAACb,SAAD,IAAcZ,KAAK,KAAKY,SAA5B,EAAuC;AACrCC,gBAAAA,OAAO,CAACC,GAAR,CAAYY,IAAI,CAACC,SAAL,CAAeF,OAAf,EAAwB,IAAxB,EAA8B,CAA9B,CAAZ;AACD;AACF,aAJK,CA3BH;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G","sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n/* global console */\n/* eslint-disable no-console, max-depth */\nimport {open, TimeUtil} from 'rosbag';\nimport {StartEndOptions} from './common';\n\nexport function bagdumpArgs(inArgs) {\n  const cmd = 'bagdump <bag>';\n\n  return inArgs.command(\n    cmd,\n    'Display information about a ROS bag',\n    {\n      ...StartEndOptions,\n      topic: {\n        alias: 't',\n        description: 'The topic to inspect'\n      },\n      dumpTime: {\n        type: 'boolean',\n        description: 'Show start and end time of the bag'\n      },\n      dumpTopics: {\n        type: 'boolean',\n        description: 'Show start and end time of the bag'\n      },\n      dumpMessages: {\n        type: 'boolean',\n        description: 'Will dump messages, if a topic is provided only those will be dumped'\n      },\n      dumpDefs: {\n        type: 'boolean',\n        description: 'Will dump message definitions'\n      }\n    },\n    bagdumpCmd\n  );\n}\n\nexport async function bagdumpCmd(args) {\n  const {bag: source, topic: mainTopic} = args;\n\n  const bag = await open(source);\n\n  if (args.dumpTime) {\n    console.log(`start_time: ${TimeUtil.toDate(bag.startTime).getTime() / 1e3}`);\n    console.log(`end_time: ${TimeUtil.toDate(bag.endTime).getTime() / 1e3}`);\n  }\n\n  if (args.dumpTopics) {\n    const seen = [];\n    for (const conn in bag.connections) {\n      const {messageDefinition, topic, type} = bag.connections[conn];\n\n      if (!seen[topic]) {\n        seen[topic] = true;\n\n        console.log(topic, type);\n        if (args.dumpDefs) {\n          console.log(messageDefinition);\n        }\n      }\n    }\n  }\n\n  if (args.dumpMessages) {\n    await bag.readMessages({}, ({topic, message}) => {\n      if (!mainTopic || topic === mainTopic) {\n        console.log(JSON.stringify(message, null, 2));\n      }\n    });\n  }\n}\n"],"file":"bagdump.js"}