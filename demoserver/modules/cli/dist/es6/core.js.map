{"version":3,"sources":["../../src/core.js"],"names":["TransformLogFlow","constructor","client","options","id","sent","onMetadata","msg","metadata","outMsg","start","start_timestamp","end","end_timestamp","sendMessage","onTransformLogDone","close","OnlyMetadata"],"mappings":"AAkBA,OAAO,MAAMA,gBAAN,CAAuB;AAC5BC,EAAAA,WAAW,CAACC,MAAD,EAASC,OAAO,GAAG,EAAnB,EAAuB;AAChC,SAAKD,MAAL,GAAcA,MAAd;AACA,SAAKC,OAAL,GAAeA,OAAf;AACA,SAAKC,EAAL,GAAU,sCAAV;AACA,SAAKC,IAAL,GAAY,KAAZ;AACD;;AAEDC,EAAAA,UAAU,CAACC,GAAD,EAAM;AACd,QAAI,CAAC,KAAKF,IAAN,IAAc,CAAC,KAAKF,OAAL,CAAaK,QAAhC,EAA0C;AACxC,YAAMC,MAAM,GAAG;AACbL,QAAAA,EAAE,EAAE,KAAKA;AADI,OAAf;;AAIA,UAAI,KAAKD,OAAL,CAAaO,KAAjB,EAAwB;AACtBD,QAAAA,MAAM,CAACE,eAAP,GAAyB,KAAKR,OAAL,CAAaO,KAAtC;AACD;;AAED,UAAI,KAAKP,OAAL,CAAaS,GAAjB,EAAsB;AACpBH,QAAAA,MAAM,CAACI,aAAP,GAAuB,KAAKV,OAAL,CAAaS,GAApC;AACD;;AAED,WAAKV,MAAL,CAAYY,WAAZ,CAAwB,eAAxB,EAAyCL,MAAzC;AAEA,WAAKJ,IAAL,GAAY,IAAZ;AACD;AACF;;AACDU,EAAAA,kBAAkB,CAACR,GAAD,EAAM;AACtB,SAAKL,MAAL,CAAYc,KAAZ;AACD;;AA7B2B;AAmC9B,OAAO,MAAMC,YAAN,CAAmB;AACxBhB,EAAAA,WAAW,CAACC,MAAD,EAAS;AAClB,SAAKA,MAAL,GAAcA,MAAd;AACD;;AAEDI,EAAAA,UAAU,CAACC,GAAD,EAAM;AACd,SAAKL,MAAL,CAAYc,KAAZ;AACD;;AAPuB","sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * This is a middleware that sends the transform log request\n * after metadata is received.\n */\nexport class TransformLogFlow {\n  constructor(client, options = {}) {\n    this.client = client;\n    this.options = options;\n    this.id = 'f8b38a41-59fa-44b9-9311-cd612886bb37';\n    this.sent = false;\n  }\n\n  onMetadata(msg) {\n    if (!this.sent && !this.options.metadata) {\n      const outMsg = {\n        id: this.id\n      };\n\n      if (this.options.start) {\n        outMsg.start_timestamp = this.options.start; // eslint-disable-line camelcase\n      }\n\n      if (this.options.end) {\n        outMsg.end_timestamp = this.options.end; // eslint-disable-line camelcase\n      }\n\n      this.client.sendMessage('transform_log', outMsg);\n\n      this.sent = true;\n    }\n  }\n  onTransformLogDone(msg) {\n    this.client.close();\n  }\n}\n\n/**\n * Close after we have received metadata\n */\nexport class OnlyMetadata {\n  constructor(client) {\n    this.client = client;\n  }\n\n  onMetadata(msg) {\n    this.client.close();\n  }\n}\n"],"file":"core.js"}