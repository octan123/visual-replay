{"version":3,"sources":["../../../src/middlewares/xviz-message-to-middleware.js"],"names":["isXVIZMessage","XVIZData","XVIZMessageToMiddleware","constructor","middleware","options","info","msg","logger","onMessage","message","data","xvizData","callMiddleware","type","xvizType","toUpperCase","onConnect","onClose","onStart","onMetadata","onStateUpdate","onTransformLog","onTransformLogDone","onTransformPointInTime","onReconfigure","onError"],"mappings":"AAeA,SAAQA,aAAR,EAAuBC,QAAvB,QAAsC,UAAtC;AAGA,OAAO,MAAMC,uBAAN,CAA8B;AACnCC,EAAAA,WAAW,CAACC,UAAD,EAAaC,OAAO,GAAG,EAAvB,EAA2B;AACpC,SAAKD,UAAL,GAAkBA,UAAlB;AACA,SAAKC,OAAL,GAAeA,OAAf;AACD;;AAEDC,EAAAA,IAAI,CAAC,GAAGC,GAAJ,EAAS;AACX,UAAM;AAACC,MAAAA;AAAD,QAAW,KAAKH,OAAtB;;AACA,QAAIG,MAAM,IAAIA,MAAM,CAACF,IAArB,EAA2B;AACzBE,MAAAA,MAAM,CAACF,IAAP,CAAY,GAAGC,GAAf;AACD;AACF;;AAODE,EAAAA,SAAS,CAACC,OAAD,EAAU;AACjB,QAAIV,aAAa,CAACU,OAAO,CAACC,IAAT,CAAjB,EAAiC;AAI/B,YAAMC,QAAQ,GAAG,IAAIX,QAAJ,CAAaS,OAAO,CAACC,IAArB,CAAjB;AACA,WAAKE,cAAL,CAAoBD,QAAQ,CAACE,IAA7B,EAAmCF,QAAnC;AACA,aAAO,IAAP;AACD;;AAED,WAAO,KAAP;AACD;;AAEDC,EAAAA,cAAc,CAACE,QAAD,EAAWR,GAAG,GAAG,EAAjB,EAAqB;AACjC,SAAKD,IAAL,cAAgBS,QAAQ,CAACC,WAAT,EAAhB;;AACA,YAAQD,QAAR;AAEE,WAAK,SAAL;AACE,aAAKX,UAAL,CAAgBa,SAAhB;AACA;;AACF,WAAK,OAAL;AACE,aAAKb,UAAL,CAAgBc,OAAhB;AACA;;AAGF,WAAK,OAAL;AACE,aAAKd,UAAL,CAAgBe,OAAhB,CAAwBZ,GAAxB;AACA;;AACF,WAAK,UAAL;AACE,aAAKH,UAAL,CAAgBgB,UAAhB,CAA2Bb,GAA3B;AACA;;AACF,WAAK,cAAL;AACE,aAAKH,UAAL,CAAgBiB,aAAhB,CAA8Bd,GAA9B;AACA;;AACF,WAAK,eAAL;AACE,aAAKH,UAAL,CAAgBkB,cAAhB,CAA+Bf,GAA/B;AACA;;AACF,WAAK,gBAAL;AACE,aAAKH,UAAL,CAAgBmB,kBAAhB,CAAmChB,GAAnC;AACA;;AACF,WAAK,yBAAL;AACE,aAAKH,UAAL,CAAgBoB,sBAAhB,CAAuCjB,GAAvC;AACA;;AACF,WAAK,aAAL;AACE,aAAKH,UAAL,CAAgBqB,aAAhB,CAA8BlB,GAA9B;AACA;;AACF,WAAK,OAAL;AACE,aAAKH,UAAL,CAAgBsB,OAAhB,CAAwBnB,GAAxB;AACA;;AAEF;AACE,cAAMG,OAAO,8CAAuCK,QAAvC,CAAb;AACA,aAAKX,UAAL,CAAgBsB,OAAhB,CAAwB;AAACZ,UAAAA,IAAI,EAAE,YAAP;AAAqBH,UAAAA,IAAI,EAAE;AAACD,YAAAA;AAAD;AAA3B,SAAxB;AACA;AAtCJ;AAwCD;;AAzEkC","sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n/* eslint-disable camelcase */\n\nimport {isXVIZMessage, XVIZData} from '@xviz/io';\n\n// Map XVIZ messages to the middleware\nexport class XVIZMessageToMiddleware {\n  constructor(middleware, options = {}) {\n    this.middleware = middleware;\n    this.options = options;\n  }\n\n  info(...msg) {\n    const {logger} = this.options;\n    if (logger && logger.info) {\n      logger.info(...msg);\n    }\n  }\n\n  // onMessage takes an Event and if the message.data\n  // contains an XVIZ message will dispatch to the middleware.\n  //\n  // Returns true if XVIZ message was dispatched\n  // Returns false if was not an XVIZ message\n  onMessage(message) {\n    if (isXVIZMessage(message.data)) {\n      // Since this is the server we assume the message\n      // we get is simple and instantiate the message immediately\n      // We also need to do this to get the \"type()\"\n      const xvizData = new XVIZData(message.data);\n      this.callMiddleware(xvizData.type, xvizData);\n      return true;\n    }\n\n    return false;\n  }\n\n  callMiddleware(xvizType, msg = {}) {\n    this.info(`[> ${xvizType.toUpperCase()}]`);\n    switch (xvizType) {\n      // Connection events\n      case 'connect':\n        this.middleware.onConnect();\n        break;\n      case 'close':\n        this.middleware.onClose();\n        break;\n\n      // XVIZ Message Types\n      case 'start':\n        this.middleware.onStart(msg);\n        break;\n      case 'metadata':\n        this.middleware.onMetadata(msg);\n        break;\n      case 'state_update':\n        this.middleware.onStateUpdate(msg);\n        break;\n      case 'transform_log':\n        this.middleware.onTransformLog(msg);\n        break;\n      case 'transform_done':\n        this.middleware.onTransformLogDone(msg);\n        break;\n      case 'transform_point_in_time':\n        this.middleware.onTransformPointInTime(msg);\n        break;\n      case 'reconfigure':\n        this.middleware.onReconfigure(msg);\n        break;\n      case 'error':\n        this.middleware.onError(msg);\n        break;\n\n      default:\n        const message = `Error: unknown XVIZ message type ${xvizType}`;\n        this.middleware.onError({type: 'xviz/error', data: {message}});\n        break;\n    }\n  }\n}\n"],"file":"xviz-message-to-middleware.js"}