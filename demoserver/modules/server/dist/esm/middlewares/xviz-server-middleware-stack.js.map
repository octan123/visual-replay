{"version":3,"sources":["../../../src/middlewares/xviz-server-middleware-stack.js"],"names":["XVIZData","XVIZServerMiddlewareStack","middlewares","middlewareDispatch","msg","name","arrayLength","length","i","middleware","handler","args","nextMiddleware","apply"],"mappings":";;AAaA,SAAQA,QAAR,QAAuB,UAAvB;AAMA,WAAaC,yBAAb;AACE,qCAAYC,WAAZ,EAAyB;AAAA;;AACvB,SAAKA,WAAL,GAAmBA,WAAnB;AACD;;AAHH;AAAA;AAAA,wBAKMA,WALN,EAKmB;AACf,WAAKA,WAAL,GAAmBA,WAAnB;AACD;AAPH;AAAA;AAAA,8BASY;AACR,WAAKC,kBAAL,CAAwB,SAAxB;AACD;AAXH;AAAA;AAAA,gCAcc;AACV,WAAKA,kBAAL,CAAwB,WAAxB;AACD;AAhBH;AAAA;AAAA,4BAkBUC,GAlBV,EAkBe;AACX,WAAKD,kBAAL,CAAwB,SAAxB,EAAmCC,GAAnC;AACD;AApBH;AAAA;AAAA,mCAsBiBA,GAtBjB,EAsBsB;AAClB,WAAKD,kBAAL,CAAwB,gBAAxB,EAA0CC,GAA1C;AACD;AAxBH;AAAA;AAAA,2CA0ByBA,GA1BzB,EA0B8B;AAC1B,WAAKD,kBAAL,CAAwB,wBAAxB,EAAkDC,GAAlD;AACD;AA5BH;AAAA;AAAA,4BA8BUA,GA9BV,EA8Be;AACX,WAAKD,kBAAL,CAAwB,SAAxB,EAAmCC,GAAnC;AACD;AAhCH;AAAA;AAAA,+BAkCaA,GAlCb,EAkCkB;AACd,WAAKD,kBAAL,CAAwB,YAAxB,EAAsCC,GAAtC;AACD;AApCH;AAAA;AAAA,kCAsCgBA,GAtChB,EAsCqB;AACjB,WAAKD,kBAAL,CAAwB,eAAxB,EAAyCC,GAAzC;AACD;AAxCH;AAAA;AAAA,uCA0CqBA,GA1CrB,EA0C0B;AACtB,WAAKD,kBAAL,CAAwB,oBAAxB,EAA8CC,GAA9C;AACD;AA5CH;AAAA;AAAA,kCA8CgBA,GA9ChB,EA8CqB;AACjB,WAAKD,kBAAL,CAAwB,eAAxB,EAAyCC,GAAzC;AACD;AAhDH;AAAA;AAAA,uCAkDqBC,IAlDrB,EAkD2BD,GAlD3B,EAkDgC;AAC5B,UAAME,WAAW,GAAG,KAAKJ,WAAL,CAAiBK,MAArC;;AACA,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,WAApB,EAAiCE,CAAC,EAAlC,EAAsC;AACpC,YAAMC,UAAU,GAAG,KAAKP,WAAL,CAAiBM,CAAjB,CAAnB;AAEA,YAAME,OAAO,GAAGD,UAAU,CAACJ,IAAD,CAA1B;;AAEA,YAAIK,OAAJ,EAAa;AACX,cAAIC,IAAI,GAAG,EAAX;;AAGA,cAAIP,GAAG,IAAI,EAAEA,GAAG,YAAYJ,QAAjB,CAAX,EAAuC;AACrCI,YAAAA,GAAG,GAAG,IAAIJ,QAAJ,CAAaI,GAAb,CAAN;AACD;;AACDO,UAAAA,IAAI,GAAG,CAACP,GAAD,CAAP;AAEA,cAAMQ,cAAc,GAAGF,OAAO,CAACG,KAAR,CAAcJ,UAAd,EAA0BE,IAA1B,CAAvB;;AACA,cAAIC,cAAc,KAAK,KAAvB,EAA8B;AAC5B;AACD;AACF;AACF;AACF;AAxEH;;AAAA;AAAA","sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nimport {XVIZData} from '@xviz/io';\n\n/**\n * This takes a set of XVIZ Server middleware's and\n * calls all there handlers in order.\n */\nexport class XVIZServerMiddlewareStack {\n  constructor(middlewares) {\n    this.middlewares = middlewares;\n  }\n\n  set(middlewares) {\n    this.middlewares = middlewares;\n  }\n\n  onClose() {\n    this.middlewareDispatch('onClose');\n  }\n\n  // Server middleware\n  onConnect() {\n    this.middlewareDispatch('onConnect');\n  }\n\n  onStart(msg) {\n    this.middlewareDispatch('onStart', msg);\n  }\n\n  onTransformLog(msg) {\n    this.middlewareDispatch('onTransformLog', msg);\n  }\n\n  onTransformPointInTime(msg) {\n    this.middlewareDispatch('onTransformPointInTime', msg);\n  }\n\n  onError(msg) {\n    this.middlewareDispatch('onError', msg);\n  }\n\n  onMetadata(msg) {\n    this.middlewareDispatch('onMetadata', msg);\n  }\n\n  onStateUpdate(msg) {\n    this.middlewareDispatch('onStateUpdate', msg);\n  }\n\n  onTransformLogDone(msg) {\n    this.middlewareDispatch('onTransformLogDone', msg);\n  }\n\n  onReconfigure(msg) {\n    this.middlewareDispatch('onReconfigure', msg);\n  }\n\n  middlewareDispatch(name, msg) {\n    const arrayLength = this.middlewares.length;\n    for (let i = 0; i < arrayLength; i++) {\n      const middleware = this.middlewares[i];\n\n      const handler = middleware[name];\n\n      if (handler) {\n        let args = [];\n\n        // Support JS objects\n        if (msg && !(msg instanceof XVIZData)) {\n          msg = new XVIZData(msg);\n        }\n        args = [msg];\n\n        const nextMiddleware = handler.apply(middleware, args);\n        if (nextMiddleware === false) {\n          break;\n        }\n      }\n    }\n  }\n}\n"],"file":"xviz-server-middleware-stack.js"}